# 部署文档（气象预警邮件通知系统）

## 1. 部署目标
在服务器上完成服务安装、配置与运行，确保天气预警与邮件通知正常可用。

## 2. 运行环境
- OS：Windows 10/11 或 Linux
- Python：3.8+（推荐 3.10）
- 网络：可访问外部天气 API 与 SMTP 服务
- 端口：默认 8000

## 3. 安装步骤
1. 进入项目根目录。
2. 创建虚拟环境（可选）：
   - Windows：`python -m venv .venv`
   - Linux：`python3 -m venv .venv`
3. 激活虚拟环境并安装依赖：
   - `pip install -r requirements.txt`

## 4. 配置说明
### 4.1 环境变量
- `WEATHER_API_KEY`：天气 API Key（优先级最高）。

### 4.2 配置文件
- `settings.json`：SMTP、预警时间、API Key 配置。
- `customers_data.json`：人员数据。
- `templates_data.json`：模板数据。
- `alert_rules.json`：规则数据。

## 5. 初始化与启动
1. 运行：`python app.py`
2. 默认监听：`0.0.0.0:8000`
3. 浏览器访问：`http://<服务器IP>:8000/login.html`

## 6. 运行与监控
- 后台线程自动启动天气预警任务。
- 查看控制台日志或 `/api/logs` 进行业务日志核对。

## 7. 备份与恢复
- 数据库：`skyalert.db`
- 配置与数据文件：`settings.json`、`customers_data.json`、`templates_data.json`
- 使用 `import_db.py` 可进行数据迁移与恢复。

## 8. 升级与回滚
1. 升级前备份 `skyalert.db` 与配置文件。
2. 替换代码并重启服务。
3. 若失败，恢复备份并回滚版本。

## 9. 安全与合规建议
- 不在仓库中保存明文凭证。
- 使用环境变量或安全配置中心存储密钥。
- 定期清理日志与历史通知数据。
