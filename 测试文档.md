# 测试文档（气象预警邮件通知系统）

## 1. 测试目标
- 验证核心业务流程与接口可用性。
- 确认敏感信息不会泄露。
- 验证系统稳定性与异常处理能力。

## 2. 测试范围
- 登录与用户管理
- 系统设置（SMTP/天气 API）
- 人员、模板、规则管理
- 通知中心与日志
- 天气接口调用与缓存

## 3. 测试环境
- OS：Windows 10/11 或 Linux
- Python：3.8+
- 数据库：SQLite
- 浏览器：Chrome/Edge

## 4. 测试策略
- 功能测试：覆盖主要流程与异常分支
- 接口测试：覆盖设置、天气与通知类接口
- 安全检查：敏感信息扫描
- 回归测试：验证关键流程未回退

## 5. 测试数据原则
- 使用虚拟邮箱与虚拟手机号。
- 禁止录入真实个人信息或企业信息。

## 6. 核心测试用例
### 6.1 账号与权限
- 创建用户后可登录。
- 角色正确时跳转管理员面板。
- 修改密码后旧密码失效。

### 6.2 系统设置
- 未配置天气 API Key 时调用 `/api/weather/search` 返回错误。
- 配置天气 API Key 后可返回 `code=200`。
- SMTP 测试成功后更新时间与状态写入。

### 6.3 人员管理
- 新增人员后可在列表显示。
- 删除人员后不可再查询到。
- 导入模板数据无格式错误。

### 6.4 模板与规则
- 创建模板并保存。
- 使用变量生成内容后无残留占位符。
- 规则启用后能触发预警。

### 6.5 通知与日志
- 审批通过后发送邮件并记录日志。
- 拒绝后日志状态正确。
- 清空队列后待发记录为 0。

### 6.6 安全扫描
- 执行敏感信息扫描确认无邮箱/密钥残留：
  - `rg -n "[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}" -S --glob '!vendor/**' .`
  - `rg -n "api[_-]?key|secret|token" -S --glob '!vendor/**' .`

## 7. 回归测试清单
- 登录、设置保存、天气查询、通知审批。

## 8. 退出准则
- 关键用例通过率 100%。
- 无 P0/P1 严重缺陷。
